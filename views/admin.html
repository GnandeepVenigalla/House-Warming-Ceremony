<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RSVP Responses</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
  <div>
    <h1 class="text-2xl font-bold mb-4">Admin - RSVP Responses</h1>
    <div class="mb-4">
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center bg-white p-4 rounded shadow">
        <div>
          <p class="text-lg font-semibold">Total RSVPs</p>
          <p id="total-rsvps" class="text-2xl font-bold">0</p>
        </div>
        <div>
          <p class="text-lg font-semibold">Total Adults</p>
          <p id="total-adults" class="text-2xl font-bold">0</p>
        </div>
        <div>
          <p class="text-lg font-semibold">Total Kids</p>
          <p id="total-kids" class="text-2xl font-bold">0</p>
        </div>
        <div>
          <p class="text-lg font-semibold">Total Yes RSVPs</p>
          <p id="total-yes" class="text-2xl font-bold">0</p>
        </div>
        <div>
          <p class="text-lg font-semibold">Total No RSVPs</p>
          <p id="total-no" class="text-2xl font-bold">0</p>
        </div>
      </div>
      <div class="mt-4 flex items-center space-x-4">
        <div>
          <label for="search-name" class="font-semibold mr-2">Search by name:</label>
          <input type="text" id="search-name" class="border rounded p-1" placeholder="Enter name" />
          <button id="search-button" class="ml-2 bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">Search</button>
        </div>
        <div>
          <label for="filter-attendance" class="font-semibold mr-2">Filter by attendance:</label>
          <select id="filter-attendance" class="border rounded p-1">
            <option value="all">All</option>
            <option value="yes">Yes</option>
            <option value="no">No</option>
          </select>
        </div>
      </div>
    </div>
    <ul id="rsvp-list" class="space-y-2">
      <!-- RSVP entries will be dynamically inserted here -->
    </ul>
  </div>
  <script>
    async function fetchRSVPs() {
      try {
        console.log('Fetching RSVP data...');
        const response = await fetch('https://house-warming-ceremony.onrender.com/api/rsvps');
        console.log('Response status:', response.status);
        const data = await response.json();
        console.log('Fetched data:', data);
        const list = document.getElementById('rsvp-list');
        const totalRsvpsElem = document.getElementById('total-rsvps');
        const totalAdultsElem = document.getElementById('total-adults');
        const totalKidsElem = document.getElementById('total-kids');
        const totalYesElem = document.getElementById('total-yes');
        const totalNoElem = document.getElementById('total-no');
        const filterSelect = document.getElementById('filter-attendance');
        const searchInput = document.getElementById('search-name');
        const searchButton = document.getElementById('search-button');
        list.innerHTML = '';
        let totalAdults = 0;
        let totalKids = 0;
        let totalYes = 0;
        let totalNo = 0;

        function renderList(filteredData) {
          list.innerHTML = '';
          filteredData.forEach(entry => {
            const li = document.createElement('li');
            li.className = 'bg-white shadow p-3 rounded';
            li.innerHTML = `
              <p><strong>Name:</strong> ${entry.name}</p>
              <p><strong>Attendance:</strong> ${entry.attendance}</p>
              <p><strong>Adults:</strong> ${entry.adults}</p>
              <p><strong>Kids:</strong> ${entry.kids}</p>
            <p><strong>Contact:</strong> ${entry.contact}</p>
            <p><strong>Comment:</strong> ${entry.comment ? entry.comment : 'N/A'}</p>
            `;
            list.appendChild(li);
          });
        }

        data.forEach(entry => {
          totalAdults += entry.adults;
          totalKids += entry.kids;
          if (entry.attendance === 'yes') totalYes++;
          else if (entry.attendance === 'no') totalNo++;
        });

        totalRsvpsElem.textContent = data.length;
        totalAdultsElem.textContent = totalAdults;
        totalKidsElem.textContent = totalKids;
        totalYesElem.textContent = totalYes;
        totalNoElem.textContent = totalNo;

        function filterAndRender() {
          const filterValue = filterSelect.value;
          const searchValue = searchInput.value.trim().toLowerCase();

          let filteredData = data;

          if (filterValue !== 'all') {
            filteredData = filteredData.filter(entry => entry.attendance === filterValue);
          }

          if (searchValue !== '') {
            filteredData = filteredData.filter(entry => entry.name.toLowerCase().includes(searchValue));
          }

          renderList(filteredData);
        }

        filterSelect.addEventListener('change', filterAndRender);
        searchButton.addEventListener('click', filterAndRender);

        renderList(data);
      } catch (error) {
        console.error('Failed to fetch RSVP data:', error);
      }
    }
    fetchRSVPs();
  </script>
</body>
</html>
